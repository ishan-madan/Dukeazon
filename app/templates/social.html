{% extends "base.html" %}

{% block content %}
<h2>Recent Feedback</h2>

<!-- Filter + limit form -->
<form method="get" class="form-inline mb-3">
  <label class="mr-2">Show:</label>
  <select name="type" class="form-control form-control-sm mr-2">
    {% set cur = request.args.get('type', 'all') %}
    <option value="all" {{ 'selected' if cur == 'all' else '' }}>All</option>
    <option value="product" {{ 'selected' if cur == 'product' else '' }}>Products</option>
    <option value="seller" {{ 'selected' if cur == 'seller' else '' }}>Sellers</option>
  </select>

  <label class="mr-2">Limit:</label>
  <input name="limit" type="number" min="1" max="50"
         value="{{ request.args.get('limit', 5) }}"
         class="form-control form-control-sm mr-2"/>

  <button class="btn btn-dark btn-sm">Apply</button>
</form>

{% if rows|length == 0 %}
  <p>No recent reviews yet.</p>
{% else %}
  <table class="table table-hover table-bordered container">
    <thead class="thead-dark">
      <tr>
        <th>Category</th>
        <th>Item/Seller</th>
        <th>Rating</th>
        <th>Comment</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
        <tr>
          <td>{{ r.type }}</td>
          <td>{{ r.target_name or r.target_id }}</td>
          <td>
            {% set stars = (r.rating|string)|int %}
            <span>
              {% for _ in range(stars) %}&#9733;{% endfor %}
              {% for _ in range(5 - stars) %}&#9734;{% endfor %}
            </span>
            <small>({{ r.rating }})</small>
          </td>
          <td>{{ r.body }}</td>
          <td>{{ r.created_at }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}
{% endblock %}
