{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">ðŸ›’ My Cart</h1>
    <div>
      <a href="{{ url_for('cart.orders', user_id=user_id) }}" class="btn btn-outline-secondary mr-2">Order History</a>
      <a href="/" class="btn btn-secondary">Continue Shopping</a>
    </div>
  </div>

  {% with messages = get_flashed_messages() %}
  {% if messages %}
  <div class="alert alert-info">
    {% for message in messages %}
    <div>{{ message }}</div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}

  {% if items %}
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Product</th>
          <th scope="col">Seller</th>
          <th scope="col">Unit Price</th>
          <th scope="col">Quantity</th>
          <th scope="col">Subtotal</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <th scope="row">{{ loop.index }}</th>
          <td>{{ item.product_name }}</td>
          <td>{{ item.seller_name }}</td>
          <td>${{ "%.2f"|format(item.unit_price) }}</td>
          <td>
            <form class="d-flex align-items-center" method="post"
                  action="{{ url_for('cart.update_item', user_id=user_id, listing_id=item.listing_id) }}">
              <input type="number" min="0" name="quantity" value="{{ item.quantity }}"
                     class="form-control form-control-sm mr-2" style="width: 90px;">
              <button type="submit" class="btn btn-sm btn-outline-primary">Save</button>
            </form>
          </td>
          <td>${{ "%.2f"|format(item.subtotal) }}</td>
          <td>
            <form method="post"
                  action="{{ url_for('cart.remove_item', user_id=user_id, listing_id=item.listing_id) }}"
                  onsubmit="return confirm('Remove this item?');">
              <button type="submit" class="btn btn-sm btn-outline-danger">Remove</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="text-end mt-4">
    <h4>Total: <span class="fw-bold text-success">${{ "%.2f"|format(total) }}</span></h4>
    <form method="post" action="{{ url_for('cart.checkout', user_id=user_id) }}" class="d-inline">
      <button type="submit" class="btn btn-primary mt-3">Checkout</button>
    </form>
  </div>

  {% else %}
  <div class="alert alert-warning text-center mt-5">
    Your cart is empty ðŸ˜¢
  </div>
  <div class="text-center">
    <a href="/" class="btn btn-dark mt-3 mr-2">Browse Products</a>
    <a href="{{ url_for('cart.orders', user_id=user_id) }}" class="btn btn-outline-secondary mt-3">View Orders</a>
  </div>
  {% endif %}
</div>
{% endblock %}
